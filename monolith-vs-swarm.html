<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>The Monolith versus The Swarm</title>
<meta name="author" content="Dan ÄŒermÃ¡k"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./node_modules/reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./node_modules/reveal.js/dist/theme/simple.css" id="theme"/>

<link rel="stylesheet" href="./node_modules/@fortawesome/fontawesome-free/css/all.min.css"/>

<link rel="stylesheet" href="./custom-style.css"/>
<link rel="stylesheet" href="./node_modules/reveal.js/plugin/highlight/zenburn.css"/>
<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = './node_modules/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h2 class="title">The Monolith versus The Swarm</h2>
<p class="subtitle" style="color: Gray;">A comparison of openSUSE's and Fedora's build infrastructure</p>
<p class="author">Dan ÄŒermÃ¡k</p>
<div style="float:left"><a href="https://fosdem.org/2024/" target="_blank"><img src="./media/FOSDEM_logo.svg" height="50px" style="margin-bottom:-12px"/> FOSDEM 2024</a></div>
<div style="float:right;font-size:35px;"><p xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#"><a href="https://creativecommons.org/licenses/by/4.0" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
CC BY 4.0 <i class="fab fa-creative-commons"></i> <i class="fab fa-creative-commons-by"></i></a></p></div>
</section>
<section>
<section id="slide-org6ca6a42">
<h2 id="org6ca6a42">who -u</h2>
<p>
Dan ÄŒermÃ¡k
</p>

<p>
 <div style="float:center">
 <table class="who-table">
 <tr><td><i class="fab fa-suse"></i></td><td> Software Developer @SUSE, SLE BCI releng</td></tr>
 <tr><td><i class="fab fa-fedora"></i></td><td> i3 SIG, Package maintainer</td></tr>
 <tr><td><i class="far fa-heart"></i></td><td> Developer Tools, Testing and Documentation, Home Automation</td></tr>
 <tr></tr>
 <tr></tr>
 <tr><td><i class="fa-solid fa-globe"></i></td><td> <a href="https://dancermak.name/">https://dancermak.name</a></td></tr>
 <tr><td><i class="fab fa-github"></i></td><td> <a href="https://github.com/dcermak/">dcermak</a> </td></tr>
 <tr><td><i class="fab fa-mastodon"></i></td><td> <a href="https://mastodon.social/@Defolos">@Defolos@mastodon.social</a></td></tr>
 </table>
 </div>
</p>
</section>
</section>
<section>
<section id="slide-org1d193ff">
<h2 id="org1d193ff">Why?</h2>
<ul>
<li class="fragment appear">very similar distributions, but no shared ancestry</li>
<li class="fragment appear">vastly different build systems</li>
<li class="fragment appear">learn from each other?</li>

</ul>
</section>
</section>
<section>
<section id="slide-org12b461e">
<h2 id="org12b461e">Parts of a Build System</h2>
<aside class="notes">
<ul>
<li>RPM building</li>
<li>repository assembly</li>
<li>image/container build</li>
<li>publishing</li>
<li>package monitoring</li>
<li>source control</li>

</ul>

</aside>

<p class="fragment (appear)">
<img src="./media/linux-distro-build-pipeline.svg"/>
</p>
</section>
</section>
<section>
<section id="slide-orgf21bdcd">
<h2 id="orgf21bdcd">The Monolith</h2>
<aside class="notes">
<p>
history:
</p>
<ul>
<li>replacement of autobuild</li>
<li>first design phase in late 2005</li>
<li>introduced to Factory in 2009</li>

</ul>

<p>
additional features:
</p>
<ul>
<li>built-in publisher</li>
<li>submit requests</li>

</ul>

</aside>

<p>
The Open Build Service
</p>

<ul>
<li class="fragment appear">distro building swiss army knife</li>
<li class="fragment appear">can build RPMs, DEBs, Arch tar.xz, containers, VMs, &#x2026;</li>
<li class="fragment appear">automated rebuilds on transitive dependency changes</li>
<li class="fragment appear">custom version control system</li>
<li class="fragment appear">staging area</li>

</ul>
</section>
<section id="slide-orgd24fee4">
<h3 id="orgd24fee4">Overview</h3>
<p>
<img src="./media/obs-overview.svg"/>
</p>
</section>
<section id="slide-org3e508b4">
<h3 id="org3e508b4">Projects and packages</h3>
<p>
<img src="./media/obs-devel_microos.png"/>
</p>

</section>
<section id="slide-org3e508b4-split">

<p>
<img src="./media/obs-architecture.svg"/>
</p>

</section>
<section id="slide-org3e508b4-split">

<p>
<img src="./media/obs-cross-project.svg"/>
</p>
</section>
<section id="slide-org7c924e6">
<h3 id="org7c924e6">Version Control</h3>
<aside class="notes">
<ul>
<li>custom via XML API</li>

</ul>

</aside>

<ul>
<li class="fragment appear"><code>osc</code> mimics subversion</li>
<li class="fragment appear">no subfolders or branches</li>
<li class="fragment appear">branching creates new projects with a <code>_link</code></li>

</ul>
</section>
<section id="slide-orgce23ce7">
<h3 id="orgce23ce7"><code>prjconf</code></h3>
<aside class="notes">
<ul>
<li>set stuff like repo types (rpm, docker, image, etc.)
or build flags</li>
<li>allows to completely override all macros &rArr; in Fedora that's done via
<code>redhat-rpm-config</code> &amp; <code>srpm-*-macros-*</code> packages
&rArr; much more flexibility per project</li>

</ul>

</aside>

<ul>
<li data-fragment-index="1" class="fragment appear">configure project building &amp; publishing</li>
<li data-fragment-index="2" class="fragment appear">tweak macros &amp; dependencies of a project</li>

</ul>

<pre  class="fragment appear" data-fragment-index="3" >
BuildFlags: sbom:spdx
PublishFlags: withsbom
Macros:
%suse_version 1699
%is_opensuse 1
%build_ldflags %{?_lto_cflags}
:Macros
</pre>
</section>
<section id="slide-org631e233">
<h3 id="org631e233">Submitrequests</h3>
<p>
<img src="media/obs-submitrequest.png" height="400px"/>
</p>

<ul>
<li class="fragment appear">send changes of a forked (aka "branched") package</li>
<li class="fragment appear">send new packages into projects</li>

</ul>
</section>
</section>
<section>
<section id="slide-org0e4649c">
<h2 id="org0e4649c">The Swarm</h2>
<p>
<img src="media/The_Zerg_swarm.png"/ height="500px">
</p>
</section>
<section id="slide-orgcb7f665">
<h3 id="orgcb7f665">Pagure</h3>
<aside class="notes">
<ul>
<li>mostly Python: Flask + pygit, some perl for SSH</li>
<li>issue &amp; PRs are saved in another repo</li>
<li>wiki is a repo
&rArr; full migration between instances possible</li>
<li>integrations not there</li>
<li>development is very slow atm</li>
<li>remote pull request support</li>

</ul>

</aside>

<p>
<img src="media/Overview-pagure-Pagure.io.png" height="300px"/>
</p>

<ul>
<li class="fragment appear">FLOSS git forge written in Python using Flask + PyGit</li>
<li class="fragment appear">every package has repositories for: source code, wiki, issues + pull requests, metadata of PRs</li>

</ul>
</section>
<section id="slide-orge1bc675">
<h3 id="orge1bc675">Koji</h3>
<aside class="notes">
<ul>
<li>mock for building -&gt; can be cheap</li>
<li>rebuilds SRPM, then per arch build</li>

<li>per target build root</li>
<li>builds on all <b>all</b> arches must succeed for build success</li>

<li>builds can be fully replayed</li>
<li>side tags, buildroot overrides</li>
<li>nowadays integration with dist-git</li>

</ul>

</aside>

<p>
<img src="./media/koji-i3-build.png"/>
</p>

<ul>
<li class="fragment appear">RPM build system using mock</li>
<li class="fragment appear">only <b>one</b> production build per NEVR can exist</li>
<li class="fragment appear">builds persist <b>for ever</b></li>

</ul>
</section>
<section id="slide-orgd8d099f">
<h3 id="orgd8d099f">Pungi</h3>
<aside class="notes">
<ul>
<li>assemble repos before image build</li>
<li>nothing like this exactly in obs
repo assembly + image build are split &rArr; leads to interesting issues</li>

</ul>

</aside>

<p>
<img src="./media/pungi-phases.svg"/>
</p>

<p class="fragment (appear)">
distribution composition tool
</p>
</section>
<section id="slide-org4e7f391">
<h3 id="org4e7f391">Image &amp; Container Building</h3>
<ol>
<li class="fragment appear">OSBS</li>
<li class="fragment appear">ImageFactory</li>
<li class="fragment appear">kiwi + koji</li>
<li class="fragment appear">osbuild</li>

</ol>
</section>
<section id="slide-orgf01605c">
<h3 id="orgf01605c">MBS</h3>
<p class="fragment (appear)">
let's not talk about this one ðŸ™Š
</p>
</section>
<section id="slide-orgd09949c">
<h3 id="orgd09949c">Koschei</h3>
<p>
<img src="./media/koschei-emacs.png"/>
</p>

<ul>
<li class="fragment appear">dependency &amp; build tracker</li>
<li class="fragment appear">runs koji scratch builds</li>

</ul>
</section>
<section id="slide-org65d0267">
<h3 id="org65d0267">Bodhi</h3>
<p>
<img src="./media/bodhi-emacs-update.png" height="350px"/>
</p>

<ul>
<li class="fragment appear">update testing facility</li>
<li class="fragment appear">vote on updates</li>
<li class="fragment appear">gate Rawhide</li>

</ul>
</section>
<section id="slide-orgce7a087">
<h3 id="orgce7a087">Fedora Messaging &amp; Notifications</h3>
<ul>
<li data-fragment-index="1" class="fragment appear"><i class="fa-brands fa-fedora"></i> messaging: AMQP based messaging bus</li>
<li data-fragment-index="2" class="fragment appear">feeds Fedora Message Notifications (<a href="https://github.com/fedora-infra/fmn">FMN</a>)</li>

</ul>

<p>
<img src="./media/fedora-notifications-on-matrix.png" class="fragment appear" data-fragment-index="3"/>
</p>
</section>
<section id="slide-orge41f848">
<h3 id="orge41f848">What about COPR?</h3>
<p class="fragment (appear)">
<img src="./media/copr.png"/>
</p>

<ul>
<li class="fragment appear">community build system</li>

</ul>
</section>
</section>
<section>
<section id="slide-org5cc072d">
<h2 id="org5cc072d">The Good, The Bad and The Ugly</h2>
<div class="outline-text-2" id="text-org5cc072d">
</div>
</section>
<section id="slide-org92d9c36">
<h3 id="org92d9c36">The Good</h3>
<aside class="notes">
<ul>
<li>OBS very friendly for expert contributors</li>

</ul>

</aside>

<p class="fragment (appear)">
<i class="fa-brands fa-opensuse"></i>
</p>

<ul>
<li class="fragment appear">very flexible</li>
<li class="fragment appear">"easy" to carry out large scale changes</li>
<li class="fragment appear"><b>one</b> place for everything</li>

</ul>

<p class="fragment (appear)">
<i class="fa-brands fa-fedora"></i>
</p>

<ul>
<li class="fragment appear">simple individual systems</li>
<li class="fragment appear">easy to extend</li>

</ul>
</section>
<section id="slide-org986d71c">
<h3 id="org986d71c">The Bad</h3>
<aside class="notes">
<ul>
<li>getting started sucks universally</li>

</ul>

</aside>

<ul>
<li class="fragment appear">getting started</li>

</ul>

<p class="fragment (appear)">
<i class="fa-brands fa-opensuse"></i>
</p>

<ul>
<li class="fragment appear">the version control</li>
<li class="fragment appear">handling of "stable" distributions</li>
<li class="fragment appear"><code>Unresolvable: have choice for</code></li>

</ul>

<p class="fragment (appear)">
<i class="fa-brands fa-fedora"></i>
</p>

<ul>
<li class="fragment appear">no automatic rebuilds</li>
<li class="fragment appear">"misuse" of systems</li>

</ul>
</section>
<section id="slide-org860ceb3">
<h3 id="org860ceb3">The Ugly</h3>
<aside class="notes">
<p>
ugly Fedora example: deltarpm
ugly OBS: git packaging
</p>

</aside>

<p class="fragment (appear)">
<i class="fa-brands fa-opensuse"></i>
</p>

<ul>
<li class="fragment appear">complexity &amp; edge cases</li>
<li class="fragment appear">hard to extend</li>

</ul>

<p class="fragment (appear)">
<i class="fa-brands fa-fedora"></i>
</p>

<ul>
<li class="fragment appear">too many systems + glue</li>
<li class="fragment appear">duplication</li>

</ul>
</section>
</section>
<section>
<section id="slide-org3185cee">
<h2 id="org3185cee">Who's better?</h2>
<aside class="notes">
<ul>
<li>opensuse: great for rolling + devel</li>
<li>fedora: great for stable distro</li>

</ul>

</aside>

<ul>
<li class="fragment appear">both setups suck in their own ways</li>
<li class="fragment appear">development &rarr; OBS</li>
<li class="fragment appear">"stable" distribution &rarr; Fedora</li>
<li class="fragment appear">development &amp; stable? ðŸ¤·</li>

</ul>
</section>
</section>
<section>
<section id="slide-org3652f2c">
<h2 id="org3652f2c">Questions?</h2>
<p class="fragment (appear)">
Answers!
</p>
</section>
</section>
</div>
</div>
<script src="./node_modules/reveal.js/dist/reveal.js"></script>
<script src="./node_modules/reveal.js/plugin/highlight/highlight.js"></script>
<script src="./node_modules/reveal.js/plugin/notes/notes.js"></script>


<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
plugins: [RevealHighlight, RevealNotes, history],
transition: 'none', hash: true
});

</script>
</body>
</html>
